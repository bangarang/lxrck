<% provide(:body_class, "top") %>
<% if notice %><p id="notice"><%= notice %></p><% end %>

<article class="tagmain"> 
  <header>
    <div class="goldtainer">
      <h1 class="title"><%= @feed.name %></h1>
      <% unless @feed.description.blank? %>
      <aside class="meta">
        <div class="content">
          <%= markdown @feed.description  %>
        </div>
      </aside>
      <% end %>
    </div>
    <% if signed_in? %>
      <p class="meta">
        <%= link_to 'Edit', edit_feed_path(@feed) %> | <%= link_to 'Back', feeds_path %> | <%= link_to 'Destroy', @feed, method: :delete, data: { confirm: 'Are you sure?' } %>
      </p>
    <% end %>
  </header>
</article>


  <% pics = [] %>
  <% for item in @feed.list %>


    <% if item.type == :photo %>
      <% pics.push(item) %>
  

    <% elsif item.type == :post %>


      <% if pics.length == 1 %> 
        <section class="goldtainer gallery clear" >
          <% pic = pics.pop %>
          <article class="pic" <% if pic.image %> style="background-image: url(<%= pic.image_url %>);"<% end %>>
              <a href="<%= photo_path(pic) %>">
                <h2><%= pic.name %></h2>
              </a>
            <% if signed_in? %>
              <p class="meta">
                <%= link_to 'Edit', edit_photo_path(pic) %> | <%= link_to 'Destroy', pic, method: :delete, data: { confirm: 'Are you sure?' } %>
              </p>
            <% end %>
          </article>
        </section>
      <% else %>

        <% until pics.empty? %>


          <% j = pics.length %>
          <% a = 3 %>
          <% if j % 2 == 0 then a = 2 end %>
          <% if j % 3 == 0 then a = 3 end %>


          <section class="goldtainer gallery<%= a %> clear">

            <% for pic in pics.pop(a) %>
            <article class="pic" <% if pic.image %> style="background-image: url(<%= pic.image_url %>);"<% end %>>
              <a href="<%= photo_path(pic) %>">
                <h2><%= pic.name %></h2>
              </a>
            <% if signed_in? %>
              <p class="meta">
                <%= link_to 'Edit', edit_photo_path(pic) %> | <%= link_to 'Destroy', pic, method: :delete, data: { confirm: 'Are you sure?' } %>
              </p>
            <% end %>
          </article>
            <% end %>
          </section>
        <% end %>
      <% end %>

    <div class="goldtainer">
        <article class="post main">
          <% if signed_in? %>
              <p class="meta">
                <%= link_to 'Edit', edit_post_path(item) %> | <%= link_to 'Destroy', item, method: :delete, data: { confirm: 'Are you sure?' } %>
              </p>
            <% end %>
            <div class="content">
              <%= markdown item.content %>
            </div>
        </article>
        <% end %>
    </div>
  <% end %> 
<% if pics.length > 0 %> 
  <% if pics.length == 1 %> 
    <section class="goldtainer gallery clear">
      <% pic = pics.pop %>
      <article class="pic" <% if pic.image %> style="background-image: url(<%= pic.image_url %>);"<% end %>>
        <a href="<%= photo_path(pic) %>">
          <h2><%= pic.name %></h2>
        </a>
      <% if signed_in? %>
        <p class="meta">
          <%= link_to 'Edit', edit_photo_path(pic) %> | <%= link_to 'Destroy', pic, method: :delete, data: { confirm: 'Are you sure?' } %>
        </p>
      <% end %>
      </article>
    </section>
  <% else %>

    <% until pics.empty? %>


      <% j = pics.length %>
      <% a = 3 %>
      <% if j % 2 == 0 then a = 2 end %>
      <% if j % 3 == 0 then a = 3 end %>
      <% if j % 4 == 0 then a = 4 end %>


      <section class="goldtainer gallery<%= a %> clear">

        <% for pic in pics.pop(a) %>
      <article class="pic" <% if pic.image %> style="background-image: url(<%= pic.image_url %>);"<% end %>>
        <a href="<%= photo_path(pic) %>">
          <h2><%= pic.name %></h2>
        </a>
      <% if signed_in? %>
        <p class="meta">
          <%= link_to 'Edit', edit_photo_path(pic) %> | <%= link_to 'Destroy', pic, method: :delete, data: { confirm: 'Are you sure?' } %>
        </p>
      <% end %>
      </article>
        <% end %>
      </section>
    <% end %>

  <% end %>
<% end %>

<% if Rails.env.production? %>
  <%= javascript_tag do %>
    mixpanel.track('Viewed <%= @feed.name %>');
  <% end %>
<% end %>