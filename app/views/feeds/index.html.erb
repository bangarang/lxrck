<% provide(:body_class, "top") %>
<h2 class="feedtitle">All Feeds</h2>
<% if signed_in? %>
<div class="togger clear">
  <%= link_to 'New Feed', new_feed_path %>
</div>
<% end %>
<div class="goldtainer clear">
<% pics = [] %>
  <% @feeds.each do |feed| %>
    <% pics.push(feed) %>
  <% end %>
  <% if pics.length == 1 %> 
        <section class="gallery clear" >
          <% feed = pics.pop %>
            <article class="tag"<% if feed.photo %> style="background-image: url(<%= feed.photo.image_url %>);"<% end %>> 
              <a href="<%= feed_path(feed) %>"> 
              <header>
                <div class="overlay"></div>
                <h2><%= feed.name %></h2>
                <aside>
                  <% if feed.description %>
                  <div class="content">
                    <%= markdown feed.description  %>
                  </div>
                  <% end %>
                </aside>
                <% if signed_in? %>
                  <p class="meta">
                    <%= link_to 'Edit', edit_feed_path(feed) %> | <%= link_to 'Back', feeds_path %> | <%= link_to 'Destroy', feed, method: :delete, data: { confirm: 'Are you sure?' } %>
                  </p>
                <% end %>
              </header>
              </a>
            </article>
        <% else %>

        <% until pics.empty? %>


          <% j = pics.length %>
          <% a = 3 %>
          <% if j % 2 == 0 then a = 2 end %>
          <% if j % 3 == 0 then a = 3 end %>


          <section class="gallery<%= a %> clear">

            <% for feed in pics.pop(a) %>
              <article class="tag"<% if feed.photo %> style="background-image: url(<%= feed.photo.image_url %>);"<% end %>> 
                <a href="<%= feed_path(feed) %>"> 
                <header>
                  <div class="overlay"></div>
                  <h2><%= feed.name %></h2>
                  <aside>
                    <% if feed.description %>
                    <div class="content">
                      <%= markdown feed.description  %>
                    </div>
                    <% end %>
                  </aside>
                  <% if signed_in? %>
                    <p class="meta">
                      <%= link_to 'Edit', edit_feed_path(feed) %> | <%= link_to 'Back', feeds_path %> | <%= link_to 'Destroy', feed, method: :delete, data: { confirm: 'Are you sure?' } %>
                    </p>
                  <% end %>
                </header>
                </a>
              </article>
            <% end %>
          </section>
        <% end %>
  <% end %>
</div>

<% if Rails.env.production? %>
  <%= javascript_tag do %>
    mixpanel.track('Viewed Feed Index');
  <% end %>
<% end %>